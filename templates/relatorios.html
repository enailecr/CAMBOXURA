{% extends "menu.html" %}
{% load static %}

{% load render_table from django_tables2 %}


{% block content %}

<div >
    <table id="CAMTecnoligaTabela">
            <caption><h1>Relatórios</h1><div align="right">

  <caption><div align="right">
    </div></caption>

        <meta http-equiv="content-type" content="text/html;charset=utf-8" />
        <head>
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        </head>
        <body>
                <div id="divCenter">
                        <br />
    <form action="{% url 'busca_relatorios'%}" method="POST" name="dados" >
                {% csrf_token %}
            <table cellspacing="10">
                    <tr>
                            <td>
                            <label for="data_inicio">Data Início: </label>
                            </td>
                            <td align="left">
                            <input type="date" name="data_inicio" value="{{dataInicioRelatorio}}">
                            </td>
                            <td>
                                    <label for="campo">Campo</label>
                                </td>
                                <td align="left">
                                        <select name="campo">
                                        <option value="vazio">Nenhum</option>
                                        <option value="org" {%if campo == "org"%} selected{%endif%}>Origem</option>
                                        <option value="dest" {%if campo == "dest"%} selected{%endif%}>Destino</option>
                                        <option value="cano" {%if campo == "cano"%} selected{%endif%}>Canal Origem</option>                                      
                                        <option value="cand" {%if campo == "cand"%} selected{%endif%}>Canal Destino</option>
                                    </select>
                                </td>
                                        <td align="left">
                                        <input type="text" name="campo_input" value="{{campo_input}}">
                                        </td>
                        <td></td>
                    </tr>
                    <tr>
                            <td>
                            <label for="data_fim">Data Fim: </label>
                            </td>
                            <td align="left">
                            <input type="date" name="data_fim" value="{{dataFimRelatorio}}">
                            </td>
                            <td>
                                    <label for="status">Status</label>
                                </td>
                                <td align="left">
                                        <select name="status">
                                        <option value="all">Todos</option>
                                        <option value="ANSWERED" {%if campo == "ANSWERED"%} selected{%endif%}>Respondidos</option>
                                        <option value="BUSY" {%if campo == "BUSY"%} selected{%endif%}>Ocupados</option>
                                        <option value="FAILED" {%if campo == "FAILED"%} selected{%endif%}>Fracassados</option>
                                        <option value="NO ANSWER" {%if campo == "NO ANSWER"%} selected{%endif%}>Sem Resposta</option>
                                    </select>
                                </td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>

                            <td><button type="submit" class="formobjects">Pesquisar</button></td>
                            </tr>
            </table>
            <br />
            <tr>
                <td>

                </td>
            </tr>
<table>
        <meta http-equiv="content-type" content="text/html;charset=utf-8" />

</table>
</body>
</form>
<!-- <button type="submit">Imprimir</button></td> -->
<input type="button" value="Imprimir" onclick="printPage('block1');"></input>
<!-- <button type="btnExport">Exportar para Excel</button></td> -->
<button onclick="exportTableToExcel('block1')">Exportar para Excel</button>

<div id=block1>
    <table id=tblData>
{% render_table table %}
</table>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="{% static 'js/jquery.btechco.excelexport.js' %}"></script>
<script src="{% static 'js/jquery.base64.js' %}"></script>
<script>
    function exportTableToExcel(tableID, filename = ''){
    var downloadLink;
    var dataType = 'application/vnd.ms-excel';
    var tableSelect = document.getElementById(tableID);
    var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

    // Specify file name
    filename = filename?filename+'.xls':'excel_data.xls';

    // Create download link element
    downloadLink = document.createElement("a");

    document.body.appendChild(downloadLink);

    if(navigator.msSaveOrOpenBlob){
        var blob = new Blob(['\ufeff', tableHTML], {
            type: dataType
        });
        navigator.msSaveOrOpenBlob( blob, filename);
    }else{
        // Create a link to the file
        downloadLink.href = 'data:' + dataType + ', ' + tableHTML;

        // Setting the file name
        downloadLink.download = filename;

        //triggering the function
        downloadLink.click();
    }
}
</script>
<script>
    function printPage(id)
    {
       var html="<html>";
       html+= document.getElementById(id).innerHTML;

       html+="</html>";

       var printWin = window.open('','','left=0,top=0,width=1,height=1,toolbar=0,scrollbars=0,status  =0');
       printWin.document.write(html);
       printWin.document.close();
       printWin.focus();
       printWin.print();
       printWin.close();
    }
    </script>
{% endblock %}
